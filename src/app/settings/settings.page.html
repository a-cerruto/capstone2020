<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-buttons slot="end">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>

  <ion-refresher slot="fixed" (ionRefresh)="refreshSettings($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-slides [options]="slideOptions">

    <ion-slide>
      <ion-grid>
        <ion-col *ngIf="userBrowseSettings">

          <div class="ion-text-center">
            <h3>Search Filters</h3>
          </div>

          <ion-item-divider mode="md">
            <ion-icon slot="start" name="film"></ion-icon>
            <ion-label>Movies</ion-label>
          </ion-item-divider>

          <ion-item lines="none">
            <ion-label>Include Pre-orders</ion-label>
            <ion-toggle (ionChange)="updateSettings('include_preorders', $event.detail.checked)" [checked]="userBrowseSettings.include_preorders"></ion-toggle>
          </ion-item>

          <ion-item lines="none">
            <ion-label>Include In-theaters</ion-label>
            <ion-toggle (ionChange)="updateSettings('include_in_theaters', $event.detail.checked)" [checked]="userBrowseSettings.include_in_theaters"></ion-toggle>
          </ion-item>

          <ion-item-divider mode="md">
            <ion-icon slot="start" name="tv"></ion-icon>
            <ion-label>Channel Selection</ion-label>
          </ion-item-divider>

          <ion-segment (ionChange)="selectChannels($event.detail.value)" [value]="userBrowseSettings.channelList">
            <ion-segment-button *ngFor="let option of channelListOptions" [value]="option.value">
              <ion-label>{{ option.title }}</ion-label>
            </ion-segment-button>
          </ion-segment>

          <div *ngIf="userBrowseSettings.channelList === channelListOptions[2].value">

            <ion-item-divider mode="md">
              <ion-icon slot="start" name="list"></ion-icon>
              <ion-label>Custom List</ion-label>
            </ion-item-divider>

            <ion-item lines="full">
              <ion-label>Channels</ion-label>
              <ion-select multiple="true" cancelText="Cancel" okText="Add" (ionChange)="updateList(true, 'channel', $event.detail.value)" placeholder="Add Channel">
                <ion-select-option *ngFor="let option of channelOptions" [value]="option" [disabled]="checkForAlreadySelected(channels, option)">{{ option.title }}</ion-select-option>
              </ion-select>
            </ion-item>

            <ion-item-sliding *ngFor="let channel of channels">
              <ion-item-options side="start">
                <ion-item-option color="danger" (click)="updateList(false, 'channel', channel)">Delete</ion-item-option>
              </ion-item-options>
              <ion-item lines="none">
                <ion-label>{{ channel.title }}</ion-label>
              </ion-item>
            </ion-item-sliding>

          </div>

          <ion-item-divider mode="md">
            <ion-icon slot="start" name="videocam"></ion-icon>
            <ion-label>Sources</ion-label>
          </ion-item-divider>

          <ion-item lines="full">
            <ion-label>Sources</ion-label>
            <ion-select multiple="true" cancelText="Cancel" okText="Add" (ionChange)="updateList(true, 'source', $event.detail.value)" placeholder="Add Source">
              <ion-select-option *ngFor="let option of sourceOptions" [value]="option" [disabled]="checkForAlreadySelected(sources, option)">{{ option.title }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item-sliding *ngFor="let source of sources">
            <ion-item-options side="start">
              <ion-item-option color="danger" (click)="updateList(false, 'source', source)">Delete</ion-item-option>
            </ion-item-options>
            <ion-item lines="none">
              <ion-label>{{ source.title }}</ion-label>
            </ion-item>
          </ion-item-sliding>

          <ion-item-divider mode="md">
            <ion-icon slot="start" name="recording"></ion-icon>
            <ion-label>Platforms</ion-label>
          </ion-item-divider>

          <ion-item lines="full">
            <ion-label>Platforms</ion-label>
            <ion-select multiple="true" cancelText="Cancel" okText="Add" (ionChange)="updateList(true, 'platform', $event.detail.value)" placeholder="Add Platform">
              <ion-select-option *ngFor="let option of platformOptions" [value]="option" [disabled]="checkForAlreadySelected(platforms, option)">{{ option.title }}</ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item-sliding *ngFor="let platform of platforms">
            <ion-item-options side="start">
              <ion-item-option color="danger" (click)="updateList(false, 'platform', platform)">Delete</ion-item-option>
            </ion-item-options>
            <ion-item lines="none">
              <ion-label>{{ platform.title }}</ion-label>
            </ion-item>
          </ion-item-sliding>

        </ion-col>
      </ion-grid>
    </ion-slide>

    <ion-slide>
      <ion-grid>
        <ion-col size-md="6" size-lg="5" size-xs="12">
          <form [formGroup]="emailForm">
            <div class="ion-text-center">
              <h3>Account Details</h3>
            </div>
            <ion-item>
              <ion-icon slot="start" name="mail"></ion-icon>
              <ion-label *ngIf="!editEmail">{{user.getEmail()}}</ion-label>
              <ion-input *ngIf="editEmail" formControlName="email" type="email" placeholder="New Email"></ion-input>
              <ion-button slot="end" *ngIf="edit && !editUsername && !editPassword" (click)="canEditEmail()">Edit</ion-button>
            </ion-item>
            <div *ngFor="let validation of validationMessages['email']">
              <ion-item lines="none" *ngIf="emailForm.controls.email.hasError(validation['type']) && emailForm.controls.email.touched && editEmail">
                <ion-text color="danger">
                  <sub>*{{ validation['message'] }}</sub>
                </ion-text>
              </ion-item>
            </div>
          </form>
          <ion-button *ngIf="editEmail"
                      type="submit"
                      expand="block"
                      [disabled]="emailForm.invalid || buttonPressed"
                      (click)="updateEmail(emailForm)">
            Update Email
          </ion-button>
          <form [formGroup]="usernameForm">
            <ion-item>
              <ion-icon slot="start" name="person"></ion-icon>
              <ion-label *ngIf="!editUsername">{{user.getUsername()}}</ion-label>
              <ion-input *ngIf="editUsername" formControlName="username" placeholder="New Username"></ion-input>
              <ion-button slot="end" *ngIf="edit && !editEmail && !editPassword" (click)="canEditUsername()">Edit</ion-button>
            </ion-item>
            <div *ngFor="let validation of validationMessages['username']">
              <ion-item lines="none" *ngIf="usernameForm.controls.username.hasError(validation['type']) && usernameForm.controls.username.touched && editUsername">
                <ion-text color="danger">
                  <sub>*{{ validation['message'] }}</sub>
                </ion-text>
              </ion-item>
            </div>
          </form>
          <ion-button *ngIf="editUsername"
                      type="submit"
                      expand="block"
                      [disabled]="usernameForm.invalid || buttonPressed"
                      (click)="updateUsername(usernameForm)">
            Update Username
          </ion-button>
          <form [formGroup]="passwordForm">
            <ion-item>
              <ion-icon slot="start" name="lock-closed"></ion-icon>
              <ion-label *ngIf="!editPassword">****************</ion-label>
              <ion-input *ngIf="editPassword" formControlName="old" type="password" placeholder="Old Password"></ion-input>
              <ion-button slot="end" *ngIf="edit && !editEmail && !editUsername" (click)="canEditPassword()">Edit</ion-button>
            </ion-item>
            <div *ngFor="let validation of validationMessages['password']">
              <ion-item lines="none" *ngIf="passwordForm.controls.old.hasError(validation['type']) && passwordForm.controls.old.touched">
                <ion-text color="danger">
                  <sub>*{{ validation['message'] }}</sub>
                </ion-text>
              </ion-item>
            </div>
            <div formGroupName="password">
              <ion-item *ngIf="editPassword">
                <ion-icon slot="start" name="key-outline"></ion-icon>
                <ion-input formControlName="set" type="password" placeholder="New Password"></ion-input>
              </ion-item>
              <ion-item *ngIf="editPassword">
                <ion-icon slot="start" name="key"></ion-icon>
                <ion-input formControlName="confirm" type="password" placeholder="Confirm New Password"></ion-input>
              </ion-item>
            </div>
            <div *ngFor="let validation of validationMessages['password']">
              <ion-item lines="none" *ngIf="passwordForm.controls.password.get('set').hasError(validation['type']) && passwordForm.controls.password.get('set').touched">
                <ion-text color="danger">
                  <sub>*{{ validation['message'] }}</sub>
                </ion-text>
              </ion-item>
            </div>
            <ion-item lines="none" *ngIf="passwordForm.controls.password.errors !== null && passwordForm.controls.password.get('confirm').touched">
              <ion-text color="danger">
                <sub>*{{ validationMessages['confirm']['message']}}</sub>
              </ion-text>
            </ion-item>
          </form>
          <ion-button *ngIf="editPassword"
                      type="submit"
                      expand="block"
                      [disabled]="passwordForm.invalid || buttonPressed"
                      (click)="updatePassword(passwordForm)">
            Update Password
          </ion-button>
          <ion-row class="ion-justify-content-end">
            <ion-button size="small" color="dark" (click)="toggleEdit()">
              <ion-icon slot="icon-only" [name]="edit ? 'lock-open':'lock-closed'"></ion-icon>
            </ion-button>
          </ion-row>
        </ion-col>
      </ion-grid>
    </ion-slide>

  </ion-slides>

</ion-content>
